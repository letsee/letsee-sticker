<!DOCTYPE html>
<html ng-app="app">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title> Sticker </title>
  
  <style media="place">
    #target{
        -letsee-target: uri('unknown');
        -letsee-position: coord(0, 0, 0);
    }     
  </style>
  <style>
    @font-face{font-family:'NotoSans-Black'; src:url('assets/fonts/NotoSans-Black.eot')}
    @font-face{font-family:'NotoSans-Black'; src:url('assets/fonts/NotoSans-Black.otf')}
    @font-face{font-family:'NotoSans-Black'; src:url('assets/fonts/NotoSans-Black.woff')}
    body, textarea {font-family:'NotoSans-Black';}

    body{
      color: #fff;
    }

    #wrapper{
      margin-top : 25px;
      /*border: 1px solid red;*/
    }

/* ======================================================================*/
/* screen icon */
/* ======================================================================*/

    .icon, .emoji-box-wrapper, .edit-title, .intro-title, .kakao-background, .edit-target-see-wrapper{
      position: absolute;      
      /*border: 1px solid red;*/
    }

    .icon.a{
        width: 100%;

    }
    .icon.b{
      right: 0;
    }
    .icon.c, .icon.d{
      bottom: 0;
    }
    .icon.d{
      right: 0;
      width: 54px;
      height: 120px;
      margin-right: 10px;
      bottom: 80px;
    }

    .icon-images{
      width: 54px;
      height: 54px;
      object-fit: contain;
    }

    .icon-images.emoji, .icon-images.text{
      float: left;
      margin-bottom: 5px;
    }

    .icon-images.trash{
      margin-top : 80px;
    }

    .icon-images.create{
        width: 72px;
        height: 72px;
        object-fit: contain;
        margin-left : -15px;
        margin-top: 50px;
    }

    .icon-images.next{
        opacity: .3;
    }

    .icon-text-sucsess{
      font-family: AppleSDGothicNeo, sans-serif; 
      font-size: 18px;
      font-weight: bold;
      letter-spacing: 0.4px;
      margin-right: 14px;
      margin-top : 14px;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);      
    }

    .icon-edit-sucsess{
      font-family: AppleSDGothicNeo, sans-serif; 
      font-size: 18px;
      font-weight: bold;
      letter-spacing: 0.4px;
      margin-right: 14px;
      margin-top : 14px;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
    }

    .icon-kakao-sucsess{
      font-family: AppleSDGothicNeo, sans-serif; 
      font-size: 18px;
      font-weight: bold;
      letter-spacing: 0.4px;
      margin-right: 14px;
      margin-top : 14px;
    }

    .icon-view-sucsess{
      position: absolute;
      bottom: -55px;
      margin-left : -70px;
      width: 109px;
      height: 32px;
    }

    icon-view-sucsess img{
        margin: 0;
        padding : 0;
        width: 100%;
        height: 100%;
    }

    .icon-view-writer{
      width: 100%;
      height: 60px;
      text-align: center;
      /*border: 1px solid red;*/      
    }

    .icon-view-writer .view-content{
      text-shadow: 0 0 7px rgba(0, 0, 0, 0.5);
      font-family: AppleSDGothicNeo, sans-serif; 
      font-size: 15px;
      letter-spacing: 0.4px;
      margin-left : 10px;
      margin-top  : 19.5px;
      opacity: 0.7;
    }    

/* ======================================================================*/
/* create emoji */
/* ======================================================================*/

    .emoji-box-wrapper{
      width: 100%;
      height: 120px;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      overflow : hidden;
      -webkit-transition: 1s;
      transition: 1s;
      border-top-right-radius: 10px;
      border-top-left-radius : 10px; 
    }
    
    .transform-active{
      height: 80%;
    }
    
    .emoji-box-btn{ 
      padding-top : 20px;
      padding-bottom : 20px;              
      position : fixed;
      width: 100%;
    }

    .emoji-box-btn-frame{ 
       margin : auto;        
       width: 55px;
       height: 7px;
       opacity: 0.4;
       border-radius: 56px;
       background-color: #ffffff;        
    }
  
    .emoji-box-content{ 
      margin-top: 30px;
      font-size : 50px;
      height: 100%;
      text-align: center;
      overflow : hidden;
      -webkit-overflow-scrolling: touch;
    }

    .emoji-box-item{
    }

    .edit-title{
      width: 100%;
      /*opacity: 0.8;*/
      font-family: AppleSDGothicNeo, sans-serif; 
      /*opacity: 0.5;*/
      font-size: 18px;
      letter-spacing: 0.4px;
      text-align: center;
      text-shadow: 0 0 6px rgba(0, 0, 0, 0.5);
      margin-top: 14px;
    }

    .intro-title{
      width: 100%;
      opacity: 0.8;
      font-family: AppleSDGothicNeo, sans-serif;
      opacity: 0.5;
      font-size: 16px;
      text-align: center;
      margin-bottom: 86px;
      bottom: 0;
    }

/* ======================================================================*/
/* kakao background */
/* ======================================================================*/

    .kakao-background{
      margin-top: -25px;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
    }

    .kakao-background-content{
      font-family: AppleSDGothicNeo, sans-serif; 
      font-size: 18px;
      line-height: 1.44;
      margin-top:70%;
      text-align: center;
      margin-bottom: 20px;
    }

    .kakao-background-content p{
      margin: 0;
    }

    .kakao-background-button{
      width: 260px;
      height: 60px;
      margin: auto;
      border-radius: 6px;
      border: solid 0.5px #f9e03d;
      /*font-weight: bold;*/
    }

    .kakao-background-button .kakao-icon, .kakao-background-button .kakao-text{
      float: left;
      color: #f9e03d;
    }

    .kakao-background-button .kakao-icon{
      margin-left : 10px;
      margin-top  : 14px;
    }

    .kakao-background-button .kakao-text{
      margin-left : 10px;
      margin-top : 16px;
    }

/* ======================================================================*/
/* ready ar */
/* ======================================================================*/

  .target-ready-content{
    width : 1000px;
    opacity: 0.8;
    text-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
    /* font-family: AppleSDGothicNeo, sans-serif; */
    font-weight: 800;
    font-size: 1em;
    letter-spacing: -0.8px;
    text-align: center;
    margin : 0;
  }

.ready-button{
  width  : 130px;
  height : 130px;
}

.ready-button img{
  width: 100%;
  height: 100%;
  /*position: absolute;*/
}

/* ======================================================================*/
/* create lettet ar */
/* ======================================================================*/
.create-target-wrapper-frame{
    position: absolute;
    width : 10%;
    height: 10%;
}

.create-target-wrapper-frame.rt, .create-target-wrapper-frame.rb{
    right: 0;
}

.create-target-wrapper-frame.lb, .create-target-wrapper-frame.rb{
    bottom: 0;
}

.create-target-wrapper{
  /*border: 1px dotted #fff;*/
  /*opacity: 0.4;*/
}

.create-target-emoji, .create-target-text{
    /*opacity: 0.7;*/
	/*opacity: 0.24;*/
	/*box-shadow: 0 0 13px 0 rgba(0, 0, 0, 0.5);  */
}

/* ======================================================================*/
/* input text ar */
/* ======================================================================*/
.input-text-area textarea, textarea{
  resize:none;
  overflow: hidden;
  width  : 360px;
  /* font-family: AppleSDGothicNeo, sans-serif; */
  font-size: 36px;
  background: transparent;
  text-decoration: none;
  color: #fff;
  outline: none;
  border: 1px solid rgba(255, 255, 255, 0);
  /*border: 1px solid red;*/
  text-align: center;
  text-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
}

.input-text-area textarea::-webkit-input-placeholder{
  color: rgba(255, 255, 255, .6);
  font-size: 30px;
  text-shadow: 0 0 7px rgba(0, 0, 0, 0.5);
}

/* ======================================================================*/
/* notification ar */
/* ======================================================================*/

.notification-title{
  opacity: 0.8;
  text-align: center;
  text-shadow: 0 0 12px rgba(0, 0, 0, 0.5);    
}

.notification-title p{
  margin: 0;
  /* font-family: AppleSDGothicNeo, sans-serif; */
  font-size: 1em;
  font-weight: 800;
}

.notification-icon{
  opacity: 0.8;  
  width: 130px;
  height: 130px;
}

.notification-icon img{  
  width: 100%;
  height: 100%;
}

.notification-content{
  opacity: 0.8;
  /*font-family: AppleSDGothicNeo, sans-serif; */
  font-size: 1em;
  font-weight: 800;
  text-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
}



/* ======================================================================*/
/* target intro */
/* ======================================================================*/
.target-intro-wrapper {
  margin: auto;
  margin-top : 26%;
  position: relative;
  overflow: hidden;
}

.target-intro-text {
  position: absolute;
  width : 100%;
  top: 48%;
  font-family: AppleSDGothicNeo, sans-serif;
  font-size: 20px;
  font-weight: bold;
  letter-spacing: -0.8px;
  text-align: center;
  text-shadow: 0 0 12px rgba(0, 0, 0, 0.3);
}
.target-intro-text p{
  margin: 0;
  /*opacity: 0.6;*/
}

.target-intro-frame{
    position: absolute;
	width: 20px;
	height: 20px;
	object-fit: contain;
	/*opacity: 0.7;        */
}

.target-intro-frame.rt, .target-intro-frame.rb{
    right: 0;
}

.target-intro-frame.lb, .target-intro-frame.rb{
    bottom: 0;
}

#target h3{
	opacity: 0.8;
	font-family: AppleSDGothicNeo, sans-serif; 
	font-weight: 800;
	text-align: center;
}

.renderable-item{
    opacity: .9;
}

.renderable-item span{
    font-size: 4.5rem;
}

.edit-target-see-wrapper{
    width: 80%;
    height: 78%;
    margin-left : 10%;
    margin-top : 50px;
    display: none;

}

.edit-target-see-content{
    margin-top : 75%;
}

.edit-target-see-frame{
    position: absolute;
}

.edit-target-see-frame.rt, .edit-target-see-frame.rb{
    right: 0;
}

.edit-target-see-frame.lb, .edit-target-see-frame.rb{
    bottom: 0;
}

.edit-target-see-wrapper p{
    margin: 0;
	font-family: AppleSDGothicNeo, sans-serif;
    opacity: 0.6;
	font-size: 22px;
	font-weight: 800;
	letter-spacing: -0.8px;
	text-align: center;
}

/* target textarea class */
.target-text-content{
  width: fit-content;
  font-size: 36px;  
  text-shadow: 0 0 8px rgba(0, 0, 0, 0.5);  
  text-align : center;  
}

  </style>
  <script src="https://hammerjs.github.io/dist/hammer.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.6.8/firebase.js"></script>
  <script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
  </head>
  <body>
    <div id="temp" style=" font-size: 36px; position:absolute; border:1px solid red; visibility: hidden;"></div>

    <div id="wrapper">

      <div class="edit-target-see-wrapper">
          <img class="edit-target-see-frame lt" src="assets/frame-b-lt.png" srcset="assets/frame-b-lt@2x.png 2x, assets/frame-b-lt@3x.png 3x">
          <img class="edit-target-see-frame rt" src="assets/frame-b-rt.png" srcset="assets/frame-b-rt@2x.png 2x, assets/frame-b-rt@3x.png 3x">
          <img class="edit-target-see-frame lb" src="assets/frame-b-lb.png" srcset="assets/frame-b-lb@2x.png 2x, assets/frame-b-lb@3x.png 3x">          
          <img class="edit-target-see-frame rb" src="assets/frame-b-rb.png" srcset="assets/frame-b-rb@2x.png 2x, assets/frame-b-rb@3x.png 3x">

          <div class="edit-target-see-content">
            <p><label id="edit-target-see-name"></label>을(를)</p>
            <p>비춰주세요</p>
          </div>
      </div>

      <div class="intro-title"></div>
            
        <div class="target-intro-wrapper">
            <img class="target-intro-frame lt" src="assets/frame-b-lt.png" srcset="assets/frame-b-lt@2x.png 2x, assets/frame-b-lt@3x.png 3x">
            <img class="target-intro-frame rt" src="assets/frame-b-rt.png" srcset="assets/frame-b-rt@2x.png 2x, assets/frame-b-rt@3x.png 3x">
            <img class="target-intro-frame lb" src="assets/frame-b-lb.png" srcset="assets/frame-b-lb@2x.png 2x, assets/frame-b-lb@3x.png 3x">          
            <img class="target-intro-frame rb" src="assets/frame-b-rb.png" srcset="assets/frame-b-rb@2x.png 2x, assets/frame-b-rb@3x.png 3x">
                        
            <div class="target-intro-text">
                <p>스티커 메세지를 남길</p>
                <p>제품을 비춰주세요</p>
            </div>
        </div>
        
      <div class="edit-title">위치/크기 조정</div>

      <div class="kakao-background">
        <div class="kakao-background-content">
          <p>스티커를 확인할 수 있게</p>
          <p>카카오톡 친구에게 렛시 링크를 보내세요!</p>
        </div>

        <div class="kakao-background-button">
          
          <div class="kakao-icon">
            <img src="assets/icn-kakao.png" srcset="assets/icn-kakao@2x.png 2x, assets/icn-kakao@3x.png 3x">
          </div>

          <a id="kakao-link-btn" href="javascript:;">
            <div onclick="typeLoadControl(1, 2);" class="kakao-text">
              <span>카카오톡으로 링크 보내기</span>
            </div>
          </a>

        </div>

      </div>
      <div class="icon a">
        <img onclick="editClose();" src="assets/btn-close.png" srcset="assets/btn-close@2x.png 2x, assets/btn-close@3x.png 3x" class="icon-images close">
        <img onclick="typeLoadControl(1);" src="assets/btn-back.png" srcset="assets/btn-back@2x.png 2x, assets/btn-back@3x.png 3x" class="icon-images back">
        <div class="icon-view-writer">
          <div class="view-content">
            <label id="view-writer"></label>님이 <label id="view-datetime"></label>에 보냄
          </div>
        </div>
      </div>

      <div class="icon b">
        <img onclick="typeLoadControl(5);" src="assets/btn-next.png" srcset="assets/btn-next@2x.png 2x, assets/btn-next@3x.png 3x" class="icon-images next">
        <div onclick="typeLoadControl(4);" class="icon-text-sucsess">완료</div>
        <div onclick="editSucsess();" class="icon-edit-sucsess">완료</div>
        <div onclick="typeLoadControl(1, 1);" class="icon-kakao-sucsess">완료</div>
      </div>

      <div class="icon c"> 
        <img onclick="_app.openCapture();" src="assets/btn-capture.png" srcset="assets/btn-capture@2x.png 2x, assets/btn-capture@3x.png 3x" class="icon-images capture">
      </div>

      <div class="icon d">
        <img onclick="typeLoadControl(3);" src="assets/btn-add-emoji.png" srcset="assets/btn-add-emoji@2x.png 2x, assets/btn-add-emoji@3x.png 3x" class="icon-images emoji">
        <img onclick="typeLoadControl(2);" src="assets/btn-add-txt.png" srcset="assets/btn-add-txt@2x.png 2x, assets/btn-add-txt@3x.png 3x" class="icon-images text">
        <img onclick="typeLoadControl(1, 0);" src="assets/btn-trash.png" srcset="assets/btn-trash@2x.png 2x, assets/btn-trash@3x.png 3x" class="icon-images trash">
        <img onclick="typeLoadControl(1);" src="assets/btn-create.png" srcset="assets/btn-create@2x.png 2x, assets/btn-create@3x.png 3x" class="icon-images create">

        <!--<div onclick="viewSucsess();" class="icon-view-sucsess">편지 남기기 <img src="assets/btn-go.png" srcset="assets/btn-go@2x.png 2x, assets/btn-go@3x.png 3x"></div>-->
        <div onclick="viewSucsess();" class="icon-view-sucsess"><img src="assets/btn-gocreate.png" srcset="assets/btn-gocreate@2x.png 2x, assets/btn-gocreate@3x.png 3x"></div>

      </div>

      <div class="emoji-box-wrapper">
          
        <div class="emoji-box-btn">
          <div class="emoji-box-btn-frame"></div>
        </div>
        <div class="emoji-box-content">
          <div class="emoji-box-item"></div>
        </div>
      </div>

    </div>

    <div id="target"></div>

    <script>

      Kakao.init('3674002005a38de9efee20f0548a93f5');
      var uuid = guid();
      var USER_NAME = '';
            
      var config = {
        apiKey: "AIzaSyAdY-yp074zuymgIbqeR1EKgGWwSQb0-pc",
        authDomain: "sticker-webapp.firebaseapp.com",
        databaseURL: "https://sticker-webapp.firebaseio.com",
        projectId: "sticker-webapp",
        storageBucket: "",
        messagingSenderId: "11949169975"
      },
      database;

      var 
          threadType = 0,
          isRedit    = false,
          isTraking  = false,
          isModeView = false,
          CURRENT_URI = '',
          currentTarget = null;

      var 
          notificationKey       = '',
          notificationObject    = null,
          notificationEntityURI = '',
          notificationName      = '';

      var world,
          content,
          editText,
          editEmoji,
          editObject,
          renderables = {
              ready : {
                  target : null,
                  text :  null,
                  plus :  null
              },
              create : {
                wrapper : null,                
                emoji : null,
                text  : null,
              },
              input : {
                text : {
                  textarea : null
                },
                emoji : {

                }
              },
              notification : {
                title : null,
                icon : null,
                content : null
              }
          };

      window.addEventListener('letsee.load', function(){ 
          createEmojiBox();
  
          var
            intro = document.querySelector('.target-intro-wrapper');
          intro.style.width  = window.screen.availWidth-(window.screen.availWidth/5)+'px';
          intro.style.height = (window.screen.availHeight-(window.screen.availHeight/4.55))+'px';  

          firebase.initializeApp(config);
          database = firebase.database();
          
          world = new Object3D();
          content = new Object3D();

          var
              param = window.location.href.split("?");

          if(param[1] !== undefined){
            var
                value = param[1].split("/");

                switch(value[0]){
                  case 'type' :
                      notificationKey = value[1];
                      
                      if(!notificationObject) select(notificationKey);
                      isModeView = true;
                      break;
                  default : break;
                }
                
                typeLoadControl(6);
          } else typeLoadControl(0);

          letsee.addEventListener("userchange", onUserInfoReceive);

          letsee.addEventListener("trackstart", function(e) {
              if (e.target.size.width > 100){
                  // resize
              } else {
                  // letsee.getEntity('unknown').renderables[0].scale.set(0.3,0.3,0.3);
                  // letsee.getEntity('unknown').renderables[1].scale.set(0.3,0.3,0.3);
              }
                
              var uri = e.target.uri;
              document.querySelector('.target-intro-wrapper').style.display = 'none';
              document.querySelector('.intro-title').style.display = 'none';

              isTraking = true;

              if (isModeView && uri !== notificationEntityURI) {
                  return alert('메시지가 담긴 사물이 아닙니다.');
              }

              if (uri !== CURRENT_URI) {
                  if (CURRENT_URI) {
                      letsee.getEntity(CURRENT_URI).removeRenderable(world);
                      letsee.getEntity(CURRENT_URI).removeRenderable(content);

                      content.children.forEach(function(item){
                          content.remove(item);
                      });

                      CURRENT_URI = uri;
                      currentTarget = letsee.getEntity(CURRENT_URI);

                      ready();
                  }

                  CURRENT_URI = uri;

                  e.target.addRenderable(world);
                  e.target.addRenderable(content);
                  console.log(e);

                  var depth = e.target.size.depth === null ? 0 : e.target.size.depth/2;

                  world.position.z = depth;
                  content.position.z = depth;
              }

              typeStartControl(e);
          });

          letsee.addEventListener('trackend', function(e){
              isTraking = false;
              typeEndControl(e);

          });

      });






        function layout(){ 
                document.querySelector('.icon-images.create').style.display = 'none';

                switch(threadType){
                    case 0 :
                        document.querySelector('.intro-title').innerText = '';
                        if(!isTraking){
                            document.querySelector('.target-intro-wrapper').style.display = 'block';
                            document.querySelector('.intro-title').style.display = 'block';
                        }

                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 1 :
                        document.querySelector('.icon-images.capture').style.display = 'block';
                        document.querySelector('.icon-images.close').style.display = 'block';
                        document.querySelector('.icon-images.next').style.display  = 'block';
                        document.querySelector('.icon-images.emoji').style.display = 'block';
                        document.querySelector('.icon-images.text').style.display  = 'block';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 2 :
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'block';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';
                        
                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 3 :
                    
                        document.querySelector('.emoji-box-btn').removeEventListener('click', scrollClick);
                        document.querySelector('.emoji-box-btn').addEventListener('click', scrollClick);

                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'block';
                        
                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';
                        
                        document.querySelector('.ar-renderer').addEventListener('touchend', closeAddEmoji); 

                        break;
                    case 4 :
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'block';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'block';
                        document.querySelector('.edit-title').style.display = 'block';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 5 :
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'block';
                        document.querySelector('.icon-images.back').style.display   = 'block';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'block';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';
 
                        break;
                    case 6 :
                        
                        if(notificationObject){
                            document.querySelector('.intro-title').innerHTML = notificationEntityName+'<span>를 비춰</span><br><span>'+notificationName+'님의 스티커 메세지를 확인하세요</span>';
                        }
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display  = 'none';
                        document.querySelector('.icon-images.next').style.display   = 'none';
                        document.querySelector('.icon-images.emoji').style.display  = 'none';
                        document.querySelector('.icon-images.text').style.display   = 'none';

                        document.querySelector('.icon-text-sucsess').style.display  = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display  = 'none';

                        document.querySelector('.icon-images.trash').style.display  = 'none';
                        document.querySelector('.edit-title').style.display         = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        document.querySelector('.target-intro-text').style.display = 'none';

                        break;
                    case 7 :
                        document.querySelector('.icon-images.capture').style.display = 'block';
                        document.querySelector('.icon-images.close').style.display  = 'none';
                        document.querySelector('.icon-images.next').style.display   = 'none';
                        document.querySelector('.icon-images.emoji').style.display  = 'none';
                        document.querySelector('.icon-images.text').style.display   = 'none';

                        document.querySelector('.icon-text-sucsess').style.display  = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';

                        document.querySelector('.emoji-box-wrapper').style.display  = 'none';

                        document.querySelector('.icon-images.trash').style.display  = 'none';
                        document.querySelector('.edit-title').style.display         = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';
                        
                        document.querySelector('.icon-view-writer').style.display  = 'block';
                        document.querySelector('.icon-view-sucsess').style.display = 'block';

                        break;
                    default : break;
                }
        }



        function onUserInfoReceive(e) {
            var user = e.user;

            if (!user) {
                if (confirm("로그인 되어 있지 않습니다.\n로그인 하시겠습니까?")) {
                    _app.openLogin();

                } else {
                    typeLoadControl(0);
                }

                return;
            }
            USER_NAME = user.lastname+user.firstname;
        }
    
        function typeLoadControl(type, deleted){
            if(type === 5 && content.children.length === 0) return;

            threadType = type;

            if(type === 4){
                if(document.getElementById('ar-textarea')){
                    if(document.getElementById('ar-textarea').value === '') return typeLoadControl(1);
                }

                // editText = document.getElementById('ar-textarea') ? '<textarea>' + document.getElementById('ar-textarea').value + '</textarea>' : editEmoji;
                editText = document.getElementById('ar-textarea') ? renderables.input.text.textarea : editEmoji;                
                 

            }
            
            if(world){
                world.children.forEach(function(item){
                    world.remove(item);

                });
            }

            switch(deleted){
                case 0 :
                    content.remove(editObject);
                    if(content.children.length === 0) document.querySelector('.icon-images.next').style.opacity = '.3';

                    editSucsess();
                    break;
                case 1 :
                    content.children.forEach(function(item){
                        content.remove(item);
                        document.querySelector('.icon-images.next').style.opacity = '.3';
                    });
                    break;
                case 2 :
                    uuid = guid();
                    insert(uuid, content);
                    
                    // var IMAGE_URL = currentTarget.image ? currentTarget.image : 'https://intra.letsee.io/test/assets/img-kakao@3x.png';

                    Kakao.Link.createDefaultButton({
                        container: '#kakao-link-btn',
                        objectType: 'feed',
                        content: {
                        title: '렛시 스티커 메세지가 도착했어요!',
                        description: USER_NAME+'님이 '+currentTarget.name+'에 스티커 메세지를 담아 보냈습니다. 지금 렛시 브라우저로 확인해보세요!',
                        imageUrl: 'https://intra.letsee.io/test/assets/img-kakao@3x.png',
                        link: {
                            mobileWebUrl: 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser',
                            webUrl: 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser',
                            androidExecParams : 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser',
                            iosExecParams : 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser'
                        }
                        },
                        buttons: [
                        {
                            title: '렛시 브라우저로 보기',
                            link: {
                                mobileWebUrl: 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser',
                                webUrl: 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser',                                
                                androidExecParams : 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser',
                                iosExecParams : 'https://vm82m.app.goo.gl/?link=https://browser.letsee.io/load?url=https://intra.letsee.io/apps/sticker?type/'+uuid+'&apn=io.letsee.browser&isi=1215633022&ibi=io.letsee.ios.browser'
                            }
                        }
                        ]
                    });          
                    
                    break;                                    
                default : break;
            }

            layout();
            
            switch(type){
                case 0 :
                    ready();
                    document.querySelector('.edit-target-see-wrapper').style.display = 'none';
                    break;
                case 1 :
                    document.body.style.backgroundColor = 'transparent';            
                    create();
                    editObject = null;
                    break;
                case 2 :
                    document.body.style.backgroundColor = 'rgba(0,0,0,0.1)';
                    inputText();
                    break;      
                case 3 :

                    document.body.style.backgroundColor = 'rgba(0,0,0,0.1)';                   
                    inputEmoji();

                    break;
                case 4 :

                    document.body.style.backgroundColor = 'transparent';
                    isRedit ? edit(editObject) : (function(){
                        typeof editText === 'string' ? edit(createDOMRanderable(editText)) : (function(){
                            editText.element.children[0].id = '';
                            edit(editText);

                        })();
                    })();

                    break;                
                case 5 :
                
                    break;
                case 6 :
                    notification();
                    break;

                case 7 :
                    view();
                    break;

                default : break;
            }
        }

      function ready(){
          
          world.position.y = 20;

          var name = '';
          if(currentTarget){
              name = currentTarget.name;
              document.getElementById('edit-target-see-name').innerText = currentTarget.name;
          }

          if(isTraking) document.querySelector('.icon-images.create').style.display = 'block';

          renderables.ready.target = createDOMRanderable('<label id="current-target-name">'+name+'</label>', 'target-ready-content');

          renderables.ready.text   = createDOMRanderable("<div>스티커 메세지를 남겨보세요", 'target-ready-content');
          renderables.ready.plus   = createDOMRanderable('<img src="assets/btn-add-content.png" srcset="assets/btn-add-content@2x.png 2x, assets/btn-add-content@3x.png 3x">', 'ready-button', createLettet);

          if(currentTarget){

              if(currentTarget.size.width > 100){
                  renderables.ready.target.position.y = (currentTarget.size.height/2)-30;
                  renderables.ready.text.position.y = ((currentTarget.size.height/2)-50);
                  renderables.ready.plus.position.y = -20;
                  renderables.ready.plus.scale.set(.5,.5,.5);
              }else{
                  renderables.ready.target.position.y = 7;
                  renderables.ready.plus.position.y   = -20; 
                  renderables.ready.text.scale.set(.3,.3,.3);
                  renderables.ready.target.scale.set(.3,.3,.3);
                  renderables.ready.plus.scale.set(.2,.2,.2);
              } 

          }

          world.add(renderables.ready.target);
          world.add(renderables.ready.text);
          world.add(renderables.ready.plus);

      }

      function create(){
          _app.getUser();

          world.position.y = 0;

          if(content.children.length === 0){
            renderables.create.wrapper = createDOMRanderable('', 'create-target-wrapper');
            renderables.create.emoji   = createDOMRanderable('<img src="assets/group-2-copy-3.png" srcset="assets/group-2-copy-3@2x.png 2x, assets/group-2-copy-3@3x.png 3x">', 'create-target-emoji');
            renderables.create.text    = createDOMRanderable('<img src="assets/icn-ar-text.png" srcset="assets/icn-ar-text@2x.png 2x, assets/icn-ar-text@3x.png 3x">', 'create-target-text');

            renderables.create.emoji.element.addEventListener("click", function(){
                typeLoadControl(3);
            });
            renderables.create.text.element.addEventListener("click", function(){
                typeLoadControl(2);
            });


            if(currentTarget.size.width > 100){
                renderables.create.emoji.position.x = -48;
                renderables.create.text.position.x  = 48;
                renderables.create.emoji.scale.set(.8,.8,.8);
                renderables.create.text.scale.set(.8,.8,.8);
            }else{
                renderables.create.emoji.position.x = -12;
                renderables.create.text.position.x  = 12;
                renderables.create.emoji.scale.set(.2,.2,.2);
                renderables.create.text.scale.set(.2,.2,.2);
            }

            var w = currentTarget.size.width,
                h = currentTarget.size.height;
            
            renderables.create.wrapper.element.style.width  = w +'px';
            renderables.create.wrapper.element.style.height = h +'px';

            renderables.create.wrapper.element.innerHTML = ''
            +'<img class="create-target-wrapper-frame lt" src="assets/frame-w-lt.png" srcset="assets/frame-w-lt@2x.png 2x, assets/frame-w-lt@3x.png 3x">'
            +'<img class="create-target-wrapper-frame rt" src="assets/frame-w-rt.png" srcset="assets/frame-w-rt@2x.png 2x, assets/frame-w-rt@3x.png 3x">'
            +'<img class="create-target-wrapper-frame lb" src="assets/frame-w-lb.png" srcset="assets/frame-w-lb@2x.png 2x, assets/frame-w-lb@3x.png 3x">'
            +'<img class="create-target-wrapper-frame rb" src="assets/frame-w-rb.png" srcset="assets/frame-w-rb@2x.png 2x, assets/frame-w-rb@3x.png 3x">';
            
            world.add(renderables.create.wrapper);
            world.add(renderables.create.emoji);
            world.add(renderables.create.text);
              
          }          

      }

      function inputText(){
          content.children.forEach(function(item){
              item.element.removeEventListener('touchstart', selectEditObject);
              if(editObject !== item ) item.element.style.opacity = '0.2';

          });

          renderables.input.text.textarea = createDOMRanderable('<textarea id="ar-textarea" placeholder="메세지를 입력해주세요" type="text"></textarea>','input-text-area');
          
          if(currentTarget.size.width > 100) renderables.input.text.textarea.scale.set(.7,.7,.7);
          else renderables.input.text.textarea.scale.set(.3,.3,.3);

          world.add(renderables.input.text.textarea);
          
          content.children.forEach(function(item){
              item.element.style.opacity = '0.2';
          });

          if(isTraking) setTimeout(function(){
              document.getElementById('ar-textarea').addEventListener('keyup', resizeTextarea);
              document.getElementById('ar-textarea').focus();
              document.getElementById('ar-textarea').focus();
              document.getElementById('ar-textarea').focus();

          }, 200);

      }

      function inputEmoji(){

      }

      function notification(){

          renderables.notification.title   = createDOMRanderable('<p><label id="noti-name">'+notificationName+'</label>님의</p> <p>스티커 메세지</p>', 'notification-title');
          renderables.notification.icon    = createDOMRanderable('<img src="assets/icn-open-messege.png" srcset="assets/icn-open-messege@2x.png 2x, assets/icn-open-messege@3x.png 3x">', 'notification-icon', viewContent);
          renderables.notification.content = createDOMRanderable('열어 볼까요?', 'notification-content');

          world.add(renderables.notification.title);
          world.add(renderables.notification.icon);
          world.add(renderables.notification.content);

      }  

      function view(){

        if(notificationObject){

          notificationObject.forEach(function(item){
              
              var element = document.createElement('div');
              var 
                div = document.createElement('div');
            
                div.className = 'target-text-content';
                div.innerHTML = item.text;
              
              element.appendChild(div);
              element.style.textShadow = '0 0 8px rgba(0, 0, 0, 0.5)';
              element.className = 'renderable-item';

              var 
                  object = new DOMRenderable(element);

              object.position.set(item.position.x, item.position.y, item.position.z);
              object.rotateX(item.rotation.x);
              object.rotateY(item.rotation.y);
              object.rotateZ(item.rotation.z);
              object.scale.set(item.scale,item.scale,item.scale);

              content.add(object);

          });
        } else{
          alert('정상적으로 등록되지 않은 메세지입니다.');
          typeLoadControl(6);

        };

        
      }

      function edit(renderable){ 
          
          content.children.forEach(function(item){
              item.element.removeEventListener('touchstart', selectEditObject);
              if(editObject !== item ) item.element.style.opacity = '0.2';

          });

          renderable.element.style.textShadow = '0 0 8px rgba(0, 0, 0, 0.5)';
          renderable.element.className = 'renderable-item';
          
          if(!isRedit){
              if(renderable.element.children[0].tagName === 'SPAN') currentTarget.size.width > 100 ? renderable.scale.set(.7,.7,.7) : renderable.scale.set(.3,.3,.3);

              if(renderable.element.children[0].tagName === 'TEXTAREA'){
                  
                  console.log(renderable.element.children[0].value);
                  console.log(renderable.element.children[0].value.replace(/\n/g, '<br/>'));

                  var 
                      value = renderable.element.children[0].value.replace(/\n/g, '<br/>');

                  renderable.element.removeChild(renderable.element.children[0]);

                  var 
                      div = document.createElement('div');
                  
                  div.className = 'target-text-content';
                  div.innerHTML = value;

                  renderable.element.appendChild(div);


              }              

              content.add(renderable);
              document.querySelector('.icon-images.next').style.opacity = '1.0';
              
              touch.current = {
                    x        : 0,
                    y        : 0,
                    z        : 0,
                    scale    : 1,
                    rotation : 0
              };              
          }

          editObject = renderable;
          touch.current.scale = editObject.scale.x;
          editObject.element.style.border = '1px solid rgba(0 ,177 , 199, 0.8)';
          if(editObject.element.children[0].tagName === 'TEXTAREA'){

            editObject.element.children[0].readOnly = true;
            // object.element.children[0].disabled = true;
            editObject.element.children[0].style.textShadow = '0 0 8px rgba(0, 0, 0, 0.5)';
          }

      }




      function editSucsess(){
          if(isRedit) isRedit = false;
          editObject.element.style.border = 'none';

          content.children.forEach(function(item){
              item.element.style.opacity = '0.9';
              item.element.addEventListener('touchstart', selectEditObject);

          });

          typeLoadControl(1);


      }

      function selectEditObject(e){
          content.children.forEach(function(item){
                
              if(item.element == e.target.parentElement){
                  isRedit = true;
                  editObject = item;
                  //

                  //

                  touch.current = {
                      x        : editObject.position.x,
                      y        : -editObject.position.y,
                      z        : -editObject.position.z,
                      scale    : editObject.scale.x,
                      rotation : editObject.rotation.z
                  };

                  typeLoadControl(4);
              }

          });
      }

      function editClose(){
        typeLoadControl(0, 1);
      }

      function createLettet(){
          typeLoadControl(1);

      }

      function viewContent(){
          typeLoadControl(7);

      }

      function viewSucsess(){
          isModeView = false;
          typeLoadControl(0, 1);

      }      
 
      function scrollClick(){
          var 
              wrapper = document.querySelector('.emoji-box-wrapper');
          
          document.querySelector('.emoji-box-content').style.overflow = wrapper.classList.toString() === 'emoji-box-wrapper' ? 'scroll' : 'hidden';

          var ctrl = wrapper.classList.toString() === 'emoji-box-wrapper' ? false : true;

          manager.get('pan').set({ enable : ctrl });
          manager.get('pinch').set({ enable : ctrl });
          manager.get('rotate').set({ enable : ctrl });

          document.querySelector('.emoji-box-content').scrollTop = 0;
          wrapper.classList.toggle('transform-active');
      }
 
      function addEmoji(text){
          if(document.querySelector('.emoji-box-wrapper').classList.toString() !== 'emoji-box-wrapper') scrollClick();

          document.querySelector('.ar-renderer').removeEventListener('touchend', closeAddEmoji);          
        //   editEmoji = text;
          editEmoji = '<span>'+text+'</span>';          
          typeLoadControl(4);

      }
      function closeAddEmoji(){
          if(document.querySelector('.emoji-box-wrapper').classList.toString() !== 'emoji-box-wrapper') scrollClick();
          
          document.querySelector('.ar-renderer').removeEventListener('touchend', closeAddEmoji);          
          typeLoadControl(1);

      }

      function typeStartControl(e){

                document.querySelector('.icon-images.create').style.display = 'none';

                switch(threadType){
                    case 0 :
                        document.querySelector('.intro-title').innerText = '';
                        if(!isTraking){
                            document.querySelector('.target-intro-wrapper').style.display = 'block';
                            document.querySelector('.intro-title').style.display = 'block';
                        }

                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 1 :
                        document.querySelector('.icon-images.capture').style.display = 'block';
                        document.querySelector('.icon-images.close').style.display = 'block';
                        document.querySelector('.icon-images.next').style.display  = 'block';
                        document.querySelector('.icon-images.emoji').style.display = 'block';
                        document.querySelector('.icon-images.text').style.display  = 'block';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 2 :
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'block';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';
                        
                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 3 :
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'block';
                        
                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 4 :
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'block';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'block';
                        document.querySelector('.edit-title').style.display = 'block';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 5 :
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display = 'none';
                        document.querySelector('.icon-images.next').style.display  = 'none';
                        document.querySelector('.icon-images.emoji').style.display = 'none';
                        document.querySelector('.icon-images.text').style.display  = 'none';

                        document.querySelector('.icon-text-sucsess').style.display = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display = 'none';

                        document.querySelector('.icon-images.trash').style.display = 'none';
                        document.querySelector('.edit-title').style.display = 'none';

                        document.querySelector('.kakao-background').style.display   = 'block';
                        document.querySelector('.icon-images.back').style.display   = 'block';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'block';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 6 :
 
                        document.querySelector('.icon-images.capture').style.display = 'none';
                        document.querySelector('.icon-images.close').style.display  = 'none';
                        document.querySelector('.icon-images.next').style.display   = 'none';
                        document.querySelector('.icon-images.emoji').style.display  = 'none';
                        document.querySelector('.icon-images.text').style.display   = 'none';

                        document.querySelector('.icon-text-sucsess').style.display  = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                            
                        document.querySelector('.emoji-box-wrapper').style.display  = 'none';

                        document.querySelector('.icon-images.trash').style.display  = 'none';
                        document.querySelector('.edit-title').style.display         = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';

                        document.querySelector('.icon-view-writer').style.display  = 'none';
                        document.querySelector('.icon-view-sucsess').style.display = 'none';

                        break;
                    case 7 :
                        document.querySelector('.icon-images.capture').style.display = 'block';
                        document.querySelector('.icon-images.close').style.display  = 'none';
                        document.querySelector('.icon-images.next').style.display   = 'none';
                        document.querySelector('.icon-images.emoji').style.display  = 'none';
                        document.querySelector('.icon-images.text').style.display   = 'none';

                        document.querySelector('.icon-text-sucsess').style.display  = 'none';
                        document.querySelector('.icon-edit-sucsess').style.display  = 'none';

                        document.querySelector('.emoji-box-wrapper').style.display  = 'none';

                        document.querySelector('.icon-images.trash').style.display  = 'none';
                        document.querySelector('.edit-title').style.display         = 'none';

                        document.querySelector('.kakao-background').style.display   = 'none';
                        document.querySelector('.icon-images.back').style.display   = 'none';
                        document.querySelector('.icon-kakao-sucsess').style.display = 'none';
                        
                        document.querySelector('.icon-view-writer').style.display  = 'block';
                        document.querySelector('.icon-view-sucsess').style.display = 'block';

                        break;
                    default : break;
                }

            document.querySelector('.edit-target-see-wrapper').style.display = 'none';
            switch(threadType){
                case 0 :
                    document.querySelector('.icon-images.create').style.display = 'block';
                    document.querySelector('.icon-images.capture').style.display = 'block';

                    document.body.style.backgroundColor = 'rgba(0,0,0,0.1)';
                    currentTarget = e.target;

                    renderables.ready.target.element.innerHTML = currentTarget.name+'에';
                    document.getElementById('edit-target-see-name').innerText = currentTarget.name;
 
                    if(currentTarget.size.width > 100){
                        renderables.ready.target.position.y = (currentTarget.size.height/2)-30;
                        renderables.ready.text.position.y = ((currentTarget.size.height/2)-50);
                        renderables.ready.plus.position.y = -20;
                        renderables.ready.plus.scale.set(.6,.6,.6);
                    }else{
                        renderables.ready.target.position.y = 7;
                        renderables.ready.plus.position.y   = -20; 
                        renderables.ready.text.scale.set(.3,.3,.3);
                        renderables.ready.target.scale.set(.3,.3,.3);
                        renderables.ready.plus.scale.set(.2,.2,.2);
                    }                    
                    break;
                case 1 :
                    var w = e.target.size.width,
                        h = e.target.size.height;
                    
                    renderables.create.wrapper.element.style.width  = w +'px';
                    renderables.create.wrapper.element.style.height = h +'px';
                    document.querySelector('.icon-images.emoji').style.display = 'block'; document.querySelector('.icon-images.text').style.display  = 'block';

                    break;                
                case 2 :
                    document.getElementById('ar-textarea').focus();
                    break;
                case 3 :
                    break;
                case 4 :
                    break;
                case 5 :
                    break;
                case 6 :
                    currentTarget = e.target;
                    if(document.getElementById('noti-name')) document.getElementById('noti-name').innerText = notificationName;

                    if(currentTarget.size.width > 100){

                        renderables.notification.title.position.y   =  85;
                        renderables.notification.content.position.y = -75;
                        renderables.notification.icon.scale.set(.8,.8,.8);

                    }else{

                        renderables.notification.title.position.y   =  35;
                        renderables.notification.content.position.y = -35;

                        renderables.notification.title.scale.set(.4,.4,.4);
                        renderables.notification.icon.scale.set(.2,.2,.2);
                        renderables.notification.content.scale.set(.4,.4,.4);

                    }                                                      

                    break;
                case 7 :
                    break;
                default : break;
            }
      }

      function typeEndControl(e){
            document.querySelector('.icon-images.capture').style.display = 'block';
            // document.querySelector('.icon-images.close').style.display = 'block';
            document.querySelector('.icon-images.next').style.display  = 'none';
            document.querySelector('.icon-images.emoji').style.display = 'none';
            document.querySelector('.icon-images.text').style.display  = 'none';

            document.querySelector('.icon-text-sucsess').style.display = 'none';
            document.querySelector('.icon-edit-sucsess').style.display  = 'none';
                                
            document.querySelector('.emoji-box-wrapper').style.display = 'none';

            document.querySelector('.icon-images.trash').style.display = 'none';
            document.querySelector('.edit-title').style.display = 'none';

            document.querySelector('.kakao-background').style.display   = 'none';
            document.querySelector('.icon-images.back').style.display   = 'none';
            document.querySelector('.icon-kakao-sucsess').style.display = 'none';

            document.querySelector('.icon-view-writer').style.display  = 'none';
            document.querySelector('.icon-view-sucsess').style.display = 'none';          

            switch(threadType){
                case 0 :
                    document.body.style.backgroundColor = 'transparent';
                    document.querySelector('.icon-images.create').style.display = 'none';
                    document.querySelector('.icon-images.capture').style.display = 'none';
                    document.querySelector('.target-intro-wrapper').style.display = 'block';
                    document.querySelector('.intro-title').style.display = 'block';
                    break;
                case 1 :
                    document.querySelector('.icon-images.close').style.display = 'block';
                    document.querySelector('.edit-target-see-wrapper').style.display = 'block'; document.querySelector('.icon-images.emoji').style.display = 'none'; document.querySelector('.icon-images.text').style.display  = 'none';
                    break;                
                case 2 :
                    document.querySelector('.icon-images.close').style.display = 'block';
                    document.querySelector('.edit-target-see-wrapper').style.display = 'block'; document.querySelector('.icon-images.emoji').style.display = 'none'; document.querySelector('.icon-images.text').style.display  = 'none';
                   
                    break;
                case 3 :
                    document.querySelector('.icon-images.close').style.display = 'block';
                    document.querySelector('.edit-target-see-wrapper').style.display = 'block'; document.querySelector('.icon-images.emoji').style.display = 'none'; document.querySelector('.icon-images.text').style.display  = 'none';
                    break;
                case 4 :
                    document.querySelector('.icon-images.close').style.display = 'block';
                    document.querySelector('.edit-target-see-wrapper').style.display = 'block'; document.querySelector('.icon-images.emoji').style.display = 'none'; document.querySelector('.icon-images.text').style.display  = 'none';

                    break;
                case 5 :
                    document.querySelector('.icon-images.close').style.display = 'block';
                    document.querySelector('.edit-target-see-wrapper').style.display = 'block'; document.querySelector('.icon-images.emoji').style.display = 'none'; document.querySelector('.icon-images.text').style.display  = 'none';
                    break;
                case 6 :
                    document.querySelector('.icon-images.close').style.display = 'none';
                    document.querySelector('.target-intro-wrapper').style.display = 'block';
                    document.querySelector('.intro-title').style.display = 'block';
                    
                    document.querySelector('.target-intro-text').style.display = 'none';
                                    
                    break;
                case 7 :

                    var name = '';
                    if(currentTarget){
                        name = currentTarget.name;
                        document.getElementById('edit-target-see-name').innerText = currentTarget.name;
                    }

                    document.querySelector('.icon-images.close').style.display = 'none';
                    document.querySelector('.edit-target-see-wrapper').style.display = 'block'; document.querySelector('.icon-images.emoji').style.display = 'none';
                    document.querySelector('.icon-images.text').style.display  = 'none';
                    break;
                default : break;
            }
      }

      function createDOMRanderable(value, className, clickCallback){

        var
            element = document.createElement('div');

        element.innerHTML = value;
        element.className = className ? className : '';
        if(clickCallback) element.onclick = clickCallback;

        return new DOMRenderable(element);
      }

      function createEmojiBox(){
          
          var emojiArray =[
                '❤️',
                '😜',
                '😝',
                '🤡',
                '😞',
                '😣',
                '😖',
                '😫',
                '😤',
                '😡',
                '😵',
                '😱',
                '😰',
                '😭',
                '😷',
                '🤒',
                '🤕', 
                '👿',
                '💩',
                '👻',
                '👍',
                '👊',
                '🙏',
                '👓',
                '😎',
                '🐶',
                '🐱',
                '🐼',
                '🐯',
                '🐷',
                '🐽',
                '😻',
                '😼',
                '😽',
                '🙀',
                '😿',
                '🔥',
                '🌈',
                '⭐',
                '✨',
                '🥂',
                '🍷',
                '💕',
                '💯',
                '♨️',
                '💤',
                '💋',
                '👄',
                '👅',
                '🙆',
                '🙇',
                '👨‍🍳',
                '🐸 ',
                '🍎',
                '🎮',
                '🎨 ',
                '✌️',
                '✊ ',
                '✋'
            ];
                
          // for(var i = emojiArray.length; i--;){
          for(var i = 0; i < emojiArray.length; i++){
              var 
                  span = document.createElement('span');
              span.innerHTML = '<span onclick="addEmoji(\''+emojiArray[i]+'\');">'+emojiArray[i]+'</span>';
              document.querySelector('.emoji-box-item').appendChild(span);
          }

          document.querySelector('.emoji-box-item').appendChild(document.createElement('br'));
          document.querySelector('.emoji-box-item').appendChild(document.createElement('br'));
      }

      function insert(key, object){
          console.log(key);

          var data = [],
              name = USER_NAME,
              datetime = new Date().getTime();

          object.children.forEach(function(item){
            
            var 
                text = item.element.children[0].tagName === 'SPAN' ? item.element.innerHTML : item.element.children[0].innerHTML;

            var prop = {
              position : {
                x : item.position.x,
                y : item.position.y,
                z : item.position.z
              },
              rotation : {
                x : item.rotation.x,
                y : item.rotation.y,
                z : item.rotation.z
              },
              scale : item.scale.x,
              text  : text
            };

            data.push(prop);
            
          });

          database.ref('stickers/' + key).set({
            name : name,
            datetime : datetime,
            entity : CURRENT_URI,
            entityName : currentTarget.name,
            data : data
          });
      }

      function select(key){

          database.ref('stickers/' + key)
          .once('value')
          .then(function(data){

              notificationName = data.val().name;
              notificationEntityURI = data.val().entity;
              notificationEntityName = data.val().entityName;
              notificationObject = data.val().data;

              document.getElementById('view-writer').innerText = notificationName;
              document.getElementById('view-datetime').innerText = formatDate(data.val().datetime, 'yyyy년 MM월 dd일');
              typeLoadControl(6);

          });
      }      

      function resizeTextarea(ev) {
          this.style.height = '48px';
          this.style.height = this.scrollHeight + 'px';
          
          document.getElementById("temp").innerText = this.value;

          if(this.value === '') this.style.width = '360px';
          else this.style.width = (document.getElementById("temp").offsetWidth+40)+'px';
        //   this.style.width = (document.getElementById("temp").offsetWidth+40)+'px';


      }

      function guid(){
        function s4(){ return ((1 + Math.random()) * 0x10000 | 0).toString(16).substring(1);}
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
      }

      function formatDate(time, format) {
          var t = new Date(time);
          var tf = function (i) { return (i < 10 ? '0' : '') + i };
          return format.replace(/yyyy|MM|dd|HH|mm|ss/g, function (a) {
              switch (a) {
                  case 'yyyy':
                      return tf(t.getFullYear());
                      break;
                  case 'MM':
                      return tf(t.getMonth() + 1);
                      break;
                  case 'mm':
                      return tf(t.getMinutes());
                      break;
                  case 'dd':
                      return tf(t.getDate());
                      break;
                  case 'HH':
                      return tf(t.getHours());
                      break;
                  case 'ss':
                      return tf(t.getSeconds());
                      break;
              }
          })
}
    
    </script>
    <script>

            window.addEventListener('touchstart', touchDown);
            window.addEventListener('touchend', touchUp);
            window.addEventListener('touchmove', touchMove);

            var manager   = new Hammer.Manager(document.body),
                Pan       = new Hammer.Pan(),
                Rotate    = new Hammer.Rotate(),
                Pinch     = new Hammer.Pinch(),
                Press     = new Hammer.Press({ time : 1000 , threshold : 15 });

            /* recognizeWith : http://hammerjs.github.io/recognize-with
            */
            Rotate.recognizeWith([Pan]);
            Pinch.recognizeWith([Rotate, Pan]);

            manager.add(Press);
            manager.add(Pan);
            manager.add(Rotate);
            manager.add(Pinch);

            var 
                touch = {
                    current : {
                        x        : 0,
                        y        : 0,
                        z        : 0,
                        scale    : 1,
                        rotation : 0
                    },
                    OLD_ROTATE_Z : null,
                    move : {
                        x : 0,
                        y : 0
                    },
                    delta : {
                        x : 0,
                        y : 0
                    },
                    press : false,
                    helper : null,
                    gestureF3 : {
                        enable : false,
                        count : 0,
                    },
                    isBoundary : false

                };

            manager.on('panmove', function(e) {
                if(touch.gestureF3.enable)return;
                if(!editObject)return;
                if(touch.isBoundary) return;

                if(currentTarget.size.width*2 < editObject.position.x || -currentTarget.size.width*2 > editObject.position.x){
                    editObject.position.x = editObject.position.x > 0 ? (currentTarget.size.width*2)-1 : -( (currentTarget.size.width*2)-1)

                    touch.current.x = editObject.position.x;
                    touch.current.y = -editObject.position.y
                    touch.isBoundary = true;
                    return;
                }
                if(currentTarget.size.height*2 < editObject.position.y || -currentTarget.size.height*2 > editObject.position.y){
                    editObject.position.y = editObject.position.y > 0 ? (currentTarget.size.height*2)-1 : -( (currentTarget.size.height*2)-1)

                    touch.current.x = editObject.position.x;
                    touch.current.y = -editObject.position.y
                    touch.isBoundary = true;
                    return;
                }

                if(touch.press) {
                    var dZ = touch.current.z + (e.deltaY/4);

                    editObject.position.z = -dZ;
                    touch.helper.position.z = editObject.position.z - 0;

                } else {
                    var dX = touch.current.x + (e.deltaX/4);
                    var dY = touch.current.y + (e.deltaY/4);

                    editObject.position.x = dX;
                    editObject.position.y = -dY;

                };

            });

            manager.on('panend', function(e) {
                if(touch.gestureF3.enable)return;
                if(!editObject)return;

                if(touch.isBoundary) touch.isBoundary = false;
                else{
                    if(touch.press) {
                        touch.press = false;
                        world.remove(touch.helper);

                        touch.current.z = touch.current.z + e.deltaY/4;
                        manager.get('pinch').set({ enable : true });
                        manager.get('rotate').set({ enable : true });

                    } else {
                        touch.current.x = touch.current.x + e.deltaX/4;
                        touch.current.y = touch.current.y + e.deltaY/4;
                    }
                }

            });

            manager.on('pinchmove', function(e) {
                if(touch.gestureF3.enable)return;
                if(!editObject)return;

                if(touch.isBoundary) return;

                if(currentTarget.size.width*2 < editObject.position.x || -currentTarget.size.width*2 > editObject.position.x){
                    editObject.position.x = editObject.position.x > 0 ? (currentTarget.size.width*2)-1 : -( (currentTarget.size.width*2)-1)

                    touch.current.x = editObject.position.x;
                    touch.current.y = -editObject.position.y
                    touch.isBoundary = true;
                    return;
                }
                if(currentTarget.size.height*2 < editObject.position.y || -currentTarget.size.height*2 > editObject.position.y){
                    editObject.position.y = editObject.position.y > 0 ? (currentTarget.size.height*2)-1 : -( (currentTarget.size.height*2)-1)

                    touch.current.x = editObject.position.x;
                    touch.current.y = -editObject.position.y
                    touch.isBoundary = true;
                    return;
                }
                
                var scale = e.scale * touch.current.scale;                
                // var scale = (e.scale-(e.scale/2)) * touch.current.scale;

                editObject.scale.set(scale, scale, scale);

                var dX = touch.current.x + (e.deltaX/4);
                var dY = touch.current.y + (e.deltaY/4);

                editObject.position.x = dX;
                editObject.position.y = -dY;                

            });

            manager.on('pinchend', function(e) {
                if(touch.gestureF3.enable)return;
                if(!editObject)return;
                if(touch.isBoundary) touch.isBoundary = false;

                touch.current.scale = e.scale * touch.current.scale;
                // touch.current.scale = (e.scale-(e.scale/2)) * touch.current.scale;

            });

            manager.on('rotatemove', function(e) {
                if(touch.gestureF3.enable)return;
                if(!editObject)return;

                if(touch.OLD_ROTATE_Z) editObject.rotateZ( (touch.OLD_ROTATE_Z - e.rotation) / 60 );
                touch.OLD_ROTATE_Z = e.rotation;

            });

            manager.on('rotateend', function(e) {
                if(touch.gestureF3.enable)return;
                if(!editObject)return;

                touch.OLD_ROTATE_Z = null;

            });

            manager.on('pressup', function(e){
                if(touch.gestureF3.enable)return;
                if(touch.press) {
                    touch.press = false;
                    world.remove(touch.helper);
                }
                
            })

            manager.on('press', function(e) {
                if(touch.gestureF3.enable)return;
                if(!editObject)return;

                touch.press = true;

                var helpElement = document.createElement('div');
                helpElement.innerHTML = '<img style="" src="assets/idc-zpos.png" srcset="assets/idc-zpos@2x.png 2x, assets/idc-zpos@3x.png 3x">';
                
                touch.helper = new DOMRenderable(helpElement);
                
                var scale = editObject.scale.x /.9;
                touch.helper.scale.set(scale,scale,scale);

                touch.helper.position.x = editObject.position.x;
                touch.helper.position.y = editObject.position.y - (scale * 35);
                touch.helper.position.z = editObject.position.z - 0;

                touch.helper.rotateX(Math.PI/2);

                world.add(touch.helper);
                manager.get('pinch').set({ enable : false });
                manager.get('rotate').set({ enable : false });                

            });          
            
            // 3F
            function touchMove(e){
                if(!editObject)return;

                if(e.touches.length > 2){
                    if(!touch.gestureF3.enable)return;

                    var
                        speed = 0.01;

                    var x = e.touches[1].pageX - touch.move.x,
                        y = e.touches[1].pageY - touch.move.y;

                    var mX = new Matrix4(),
                        mY = new Matrix4();

                    mX.makeRotationX( y * speed );
                    mY.makeRotationY( x * speed );

                    var m = new Matrix4(),
                        mQ = new Quaternion();
                        
                    m.multiplyMatrices( mX, mY );
                    mQ.setFromRotationMatrix(m);

                    mQ.multiply(editObject.quaternion);

                    editObject.quaternion.copy(mQ);

                    touch.move.x = e.touches[1].pageX;
                    touch.move.y = e.touches[1].pageY;

                }

            }

            function touchDown(e){
                if(!editObject)return;

                if(e.touches.length > 2){
                    touch.gestureF3.enable = true;

                    manager.get('pan').set({ enable : false });
                    manager.get('pinch').set({ enable : false });
                    manager.get('rotate').set({ enable : false });

                    touch.move.x = e.touches[1].pageX;
                    touch.move.y = e.touches[1].pageY;
                    
                }

            }

            function touchUp(e){
                if(!editObject)return;
                
                if(touch.gestureF3.enable) touch.gestureF3.count++;

                if(touch.gestureF3.count === 3){
                    manager.get('pan').set({ enable : true });
                    manager.get('pinch').set({ enable : true });
                    manager.get('rotate').set({ enable : true });
                    
                    touch.gestureF3.count = 0;
                    touch.gestureF3.enable = false;

                }

            }




    </script>     
  </body>
</html>